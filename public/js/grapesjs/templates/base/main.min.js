!function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=27)}({27:function(e,t,a){e.exports=a("eLOc")},eLOc:function(e,t){$(document).ready(function(){function e(e){$("button.button-choose").addClass("disabled"),$("ul.nav-tabs li .label_top_recomended").remove(),$("ul.nav-tabs li").each(function(t){t!==e?$(this).addClass("inactive"):($(this).children("a").prepend('<span class="label_top corporate-bg-color">Выбран</span>'),$(this).children("a").trigger("click"))})}function t(e){var t=$("body");t.find('.modal[role="dialog"]').remove(),t.append('<div class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><h4 class="text-center">'+e+"</h4></div></div></div></div>"),$(".modal").modal("show")}function a(e){if(e){var t=e.replace(/[^0-9.]/g,"");if(t)return parseFloat(t)}return 0}function n(e){var t=(e=(e+="").replace(/(\.(.*))/g,"")).split(""),a="";if(e.length>3){for(var n=t.length-1,i=1;n>=0;n--,i++)a=t[n]+a,i%3==0&&(a=" "+a);return a}return e}function i(e){var t="";if(e){var a="";e.megaplan_field_values&&(a=e.megaplan_field_values),e.amocrm_field_value&&-1===(a=e.amocrm_field_value).indexOf("-")&&(a*=1e3);var n=new Date(a),i=n.getDate()+"",d=n.getMonth()+1+"",l=n.getFullYear();if(1==i.length&&(i="0"+i),1==d.length&&(d="0"+d),t=i+"."+d+"."+l,e.megaplan_field_values&&"DateTimeField"==e.field.content_type){var r=n.getHours()+"",o=n.getMinutes()+"";1==r.length&&(r="0"+r),1==o.length&&(o="0"+o),t+=" "+r+":"+o}}return t}$(document).on("slider:add","#wrapper",function(e){$(".cbp-fwslider").each(function(){$(this).data("cbpFWSlider")&&$(this).cbpFWSlider("destroy"),$(this).cbpFWSlider(),$(this).find(".cbp-fwprev").click()})}),-1===location.href.indexOf("about:blank")&&($(".js-fancybox-offer").fancybox({baseClass:"fancybox-offer"}),$.get(location.href.replace(location.hash,"")+"/json",function(d){var l=$("#wrapper");l.fadeIn(),$(".cbp-fwslider").find("nav").remove(),$(".cbp-fwslider").cbpFWSlider();var r=d.number,o=d.created_at_formatted,c=d.updated_at_formatted.split(" ");new Date(d.updated_at);l.find(".cp-details__number").text("№"+r+" от "+o+" (обновлено "+c[1]+" в "+c[0]+")");var f=d.variants,s=-1;!function(e){var t=e&&e.updateId,a=e&&e.variants;if(a){var n=$("#wrapper");a.forEach(function(e,a){var i=n.find(".nav-tabs li:nth-child("+(a+1)+") a");if(i.length){var d=n.find(".tab-content .tab-pane"+i.attr("href"));i.attr("data-db-id",e.id),e.fields&&e.fields.forEach(function(e,a){var n=d.find(".row.tab-pane-inner__menu-row-heading > div:nth-child("+(e.index+1)+")");n.length&&(n.attr("data-db-id")&&!t||n.attr("data-db-id",e.id))}),e.products&&e.products.forEach(function(e,a){if(e.index){var n=d.find(".row.tab-pane-inner__menu-row:nth-child("+(e.index+1)+")");n.length&&(n.attr("data-db-id")&&!t||n.attr("data-db-id",e.id),e.values&&e.values.forEach(function(e,a){var i=n.children().eq(e.index);i.attr("data-db-id")&&!t||i.attr("data-db-id",e.id)}))}}),e.special_discounts&&e.special_discounts.forEach(function(e,a){var n=d.find(".kp10-special-discount > div:nth-child("+(e.index+1)+")");n.length&&(n.attr("data-db-id")&&!t||n.attr("data-db-id",e.id))})}})}}({variants:f}),f.forEach(function(e,t){if(1===e.selected&&(s=t),e.active&&(e.fields&&e.fields.forEach(function(e){var t=l.find('[data-db-id="'+e.id+'"]');t.length&&t.text(e.name)}),e.products)){var i=0,d=0,r=!1,o=[],c=0;e.products.sort(function(e,t){return e.index-t.index}),e.products.forEach(function(t){var f=0,s=0,u=0,p=1,v=0,h=l.find('.nav-tabs a[data-db-id="'+e.id+'"]'),_=h.length&&l.find('.tab-pane[role="tabpanel"]'+h.attr("href"));t.group&&(c=t.id);var b=l.children(t.fake_product_id);if(b&&b.find(".modal-product__info > div").html(t.description),t.values){t.values&&t.values.sort(function(e,t){return e.index-t.index});var m="",x="",g="";!_||t.group||b.length||(x=_.find(".row.tab-pane-inner__menu-row").last().clone(),m=_.find(".tab-content__list").children().last().clone(),g=l.children(x.attr("data-src")).clone(),x.attr("data-src",t.fake_product_id),m.children("a").attr("data-src",t.fake_product_id),g.attr("data-src",t.fake_product_id).attr("id",t.fake_product_id.substr(1)),x.find(".kp10-cell-name img").attr("src",t.image),m.find("img.card-offer__preview-img").attr("src",t.image),g.find(".modal-product__preview-img").attr("src",t.image),x.attr("data-db-id","").find("[data-db-id]").attr("data-db-id",""));var k=1;t.values.forEach(function(e){var i=l.find('[class*="col-"][data-db-id="'+e.id+'"]');if(t.group)i&&i.children().eq(0).text(e.value);else{var d=i.closest('[role="tabpanel"]').find('.tab-content__list a[data-src="'+t.fake_product_id+'"]');switch(e.type){case"name":i.length&&(i.find(".row div:nth-child(2) span").text(e.value),d.find(".kp10-cell-name > span").text(e.value),b.find(".kp10-cell-name > span").text(e.value)),x&&x.find(".kp10-cell-name > .row div:nth-child(2) span").text(e.value),m&&m.find(".kp10-cell-name > span").text(e.value),g&&g.find(".kp10-cell-name > span").text(e.value);break;case"price":u=a(e.value),i.length&&(i.find(".kp10-cell-price").text(u),d.find(".kp10-cell-price").text(u),b.find(".kp10-cell-price").text(e.value)),x&&x.find(".kp10-cell-price").text(u),m&&m.find(".kp10-cell-price").text(u),g&&g.find(".kp10-cell-price").text(u);break;case"count":f=a(e.value),i.length&&(i.text(f),d.find(".kp10-cell-count").text(f),b.find(".kp10-cell-count").text(f)),x&&x.find(".kp10-cell-count").text(f),m&&m.find(".kp10-cell-count").text(f),g&&g.find(".kp10-cell-count").text(u);break;case"discount":s=a(e.value),i.length&&(r=discountEnabledGlobal=!0,i.text(e.value),b.find(".kp10-discount").text(e.value)),x&&x.find(".kp10-discount").text(s),g&&g.find(".kp10-discount").text(s);break;case"price-with-discount":x&&x.find('[data-gjs-type="discount"]').last().text(e.value);break;case"good-coll":if(i.length)i.text(a(e.value)),b.find(".modal-product__content > div.kp10-goods-coll > div:nth-child("+k+")").find("span").text(a(e.value)),e.value_in_price&&(p*=a(e.value));x&&x.find(".kp10-good-coll").eq(k-1).text(a(e.value)),g&&g.find(".modal-product__content > div.kp10-goods-coll > div:nth-child("+k+") span").text(a(e.value)),k+=1;break;case"cost":v=a(e.value),i.length&&(i.find(".kp10-cell-cost").text(n(v)),b.find(".kp10-cell-cost").text(n(v))),x&&x.find("span.kp10-cell-cost").text(n(v)),g&&g.find(".kp10-cell-cost").text(n(v))}}}),x&&_.find(".tab-content__table.table-offer").append(x),m&&_.find(".tab-content__list").append(m),g&&l.append(g)}if(i+=v,r&&(d+=u*f*p),c){var w=o.filter(function(e){return e.groupId==c});w.length?w[0].cost+=v:o.push({groupId:c,cost:v})}}),e.special_discounts&&e.special_discounts.forEach(function(e){i-=a(e.value)});var f=l.find('.tab-content .tab-pane[role="tabpanel"]').eq(t);if(f.length&&(l.find('[role="tab"][data-db-id="'+e.id+'"] .kp10-header-price').text(n(i)),f.find(".price-decoration .tab-pane-inner__price-cell_finally span").text(n(i)),r&&f.find(".kp10-pane-discount > div:last-child span").text(n(d)),e.tax)){var u=f.find(".total-sum-tax .tax-value");if(u.length){var p=n(Math.round(i/1.18*.18));u.text(p)}}o&&o.forEach(function(e){l.find('.tab-pane-inner__menu-row[data-db-id="'+e.groupId+'"] .kp10-group-cost').text(n(e.cost))})}}),d.amocrm_deal&&d.amocrm_deal.data&&d.amocrm_deal.data.fields&&d.amocrm_deal.data.fields.forEach(function(e){var t=l.find('.add-order[data-field-id="'+e.amocrm_field_id+'"]');if(t.length){var a=e.values&&e.values[0]&&e.values[0].amocrm_field_value;a&&(3==e.custom_field.amocrm_field_type_id&&(a=1==a?"Да":"Нет"),-1!==[6,14].indexOf(e.custom_field.amocrm_field_type_id)&&(a=i(e.values[0])),t.children().eq(1).text(a))}}),d.megaplan_deal&&d.megaplan_deal.values&&d.megaplan_deal.values.forEach(function(e){var t=l.find('.add-order[data-field-id="'+e.field.field_id+'"]');if(t.length){var a=e.megaplan_field_values;a&&("BoolField"==e.field.content_type&&(a=1==a?"Да":"Нет"),"DateField"!=e.field.content_type&&"DateTimeField"!=e.field.content_type||(a=i(e)),t.children().eq(1).text(a))}}),-1===s?($(".js-fancybox-offer").fancybox({baseClass:"fancybox-offer"}),$("button.button-choose").click(function(){var a=$("ul.nav-tabs li.active:not(.disabled-variant-selected)").index();-1!==a?$.post(location.href+"/variant",{index:a},function(n){e(a),t("Вариант успешно выбран")}).fail(function(e){t(e.responseJSON.errors)}):t("Ошибка выбора Варианта. Обновите страницу и повторите попытку")})):e(s)}).fail(function(e){e.responseJSON&&e.responseJSON.errors?t(e.responseJSON.errors):t("Произошла ошибка при получении информации о КП. Обновите страницу и повторите попытку")}),$("a.download-excel").click(function(e){e.preventDefault(),t("Формирование Excel..."),location.href=window.location.href+"/excel"}),$("a.download-pdf").click(function(e){e.preventDefault(),t("Формирование PDF..."),location.href=window.location.href+"/pdf"}),$("a.download-pdf-full").click(function(e){e.preventDefault(),t("Формирование PDF..."),location.href=window.location.href+"/pdf/full"}))})}});