!function(t){var i={};function a(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=i,a.d=function(t,i,e){a.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:e})},a.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(i,"a",i),i},a.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},a.p="",a(a.s=23)}({23:function(t,i,a){t.exports=a("yKPU")},yKPU:function(t,i){new window.Vue({el:"#app",data:{scenario:[],eventsList:[],additionalEventsList:[],additionalSecondEventsList:[],additionalActionsList:[],additionalSecondActionsList:[],actionsList:[],storedScenario:[],saveScenario:{event:[],action:[],additional_event:[],additional_action:[]},crmStates:[],additionalEventFlag:!1,additionalSecondEventFlag:!1,additionalSecondActionFlag:!1,additionalSecondEventCondition:!1,additionalSecondActionCondition:!1,additionalActionFlag:!1,additionalActionType:"",fullConditions:!1,disabledSaveBtn:!1,disIfChanged:!1},mounted:function(){var t=this;window.axios.get("/settings/scenario/json").then(function(i){if(i.data.status){var a=i.data.scenario;$.each(a,function(i,a){var e=a.actions,n=a.events,o="",s="";n.length&&$.each(n,function(t,i){switch(Number(a.event_id)){case 2:switch(i.event_type){case"id":i.event_value;break;case"name":o=i.event_value}break;case 8:switch(i.event_type){case"id":i.event_value;break;case"program_name":o='по схеме "'+i.event_value+'"';break;case"crm_status_name":o+=' на статус "'+i.event_value+'"'}break;case 9:switch(i.event_type){case"status_id":i.event_value;break;case"status_name":o='на "'+i.event_value+'"'}}}),e.length&&$.each(e,function(t,i){switch(Number(a.action_id)){case 4:switch(i.action_type){case"text":s='с описанием: "'+i.action_value+'"'}break;case 7:switch(i.action_type){case"id":i.action_value;break;case"program_name":s='по схеме "'+i.action_value+'"';break;case"crm_status_name":s+=' на статус "'+i.action_value+'"'}break;case 8:switch(i.action_type){case"status_id":i.action_value;break;case"status_name":s='на "'+i.action_value+'"'}}}),t.storedScenario.push({event_id:a.event_id,event_name:a.scenario_event.name,action_id:a.action_id,action_name:a.scenario_action.name,additional_event:o,additional_action:s})})}}).catch(function(t){window.ajaxError(t)})},methods:{showStoredScenario:function(t){},createScenario:function(){var t=this;this.saveScenario.event=[],this.saveScenario.action=[],this.saveScenario.additional_event=[],this.saveScenario.additional_action=[],this.eventsList=[],this.actionsList=[],this.additionalEventsList=[],this.additionalSecondEventsList=[],this.additionalActionsList=[],this.additionalSecondActionsList=[],this.additionalEventFlag=!1,this.additionalActionFlag=!1,this.additionalSecondEventFlag=!1,this.additionalSecondActionFlag=!1,this.additionalSecondEventCondition=!1,this.additionalSecondActionCondition=!1,window.axios.get("/settings/scenario/get/events").then(function(i){var a=i.data;a.length&&($.each(a,function(i,a){t.eventsList.push({id:a.id,name:a.name})}),t.fullConditions=!1,$("#modal-scenario").modal("show"))}).catch(function(t){window.ajaxError(t)})},selectEvent:function(t){var i=this,a=Number(t.target.value),e=$(t.target).find("option:selected").text().trim();-1!=a?(this.disIfChanged=!0,window.axios.get("/settings/scenario/get/actions/"+a).then(function(t){var n=t.data.actions,o=t.data.additional_events;switch(i.additionalEventsList=[],i.additionalSecondEventsList=[],i.additionalEventFlag=!1,i.additionalActionFlag=!1,i.additionalSecondEventFlag=!1,i.additionalSecondActionFlag=!1,i.additionalSecondEventCondition=!1,i.additionalSecondActionCondition=!1,i.additionalActionsList=[],i.additionalSecondActionsList=[],a){case 2:i.additionalEventFlag=!0,i.additionalEventsList.push({id:-1,name:"Укажите время"},{id:10800,name:"3 часов"},{id:21600,name:"6 часов"},{id:86400,name:"1 дня"},{id:172800,name:"2 дней"},{id:259200,name:"3 дней"});break;case 8:o.programs.length&&(i.crmStates=o,i.additionalEventFlag=!0,i.additionalEventsList.push({id:-1,name:"Выберите схему сделки или воронку"}),$.each(o.programs,function(t,a){i.additionalEventsList.push({id:a.program_id,name:a.program_name})}));break;case 9:o.length&&(i.additionalEventFlag=!0,i.additionalEventsList.push({id:-1,name:"Выберите статус КП"}),$.each(o,function(t,a){i.additionalEventsList.push({id:a.id,name:a.name})}))}i.actionsList=[],$.each(n,function(t,a){i.actionsList.push({id:a.id,name:a.name})}),i.disIfChanged=!1,i.saveScenario.event[0]={id:a,name:e},i.checkConditions()}).catch(function(t){i.actionsList=[],i.additionalEventsList=[],window.ajaxError(t)})):(this.saveScenario.event=[],this.saveScenario.action=[],this.additionalEventsList=[],this.actionsList=[],this.additionalActionFlag=!1,this.additionalSecondEventFlag=!1,this.fullConditions=!1)},selectAdditionalEvent:function(t){var i=this,a=t.target.value,e=$(t.target).find("option:selected").text().trim();if(-1!=a)switch(this.saveScenario.event[0].id){case 2:this.saveScenario.additional_event[0]=[{event_type:"id",event_value:a},{event_type:"name",event_value:e}],this.checkConditions();break;case 8:this.saveScenario.additional_event[0]=[{event_type:"type",event_value:2},{event_type:"crm",event_value:this.crmStates.crm_type},{event_type:"program_id",event_value:a},{event_type:"program_name",event_value:e}],this.additionalSecondEventsList=[],$.each(this.crmStates.programs,function(t,e){e.program_id==a&&(i.additionalSecondEventsList=e.states)}),this.additionalSecondEventFlag=!0;break;case 9:this.saveScenario.additional_event[0]=[{event_type:"type",event_value:3},{event_type:"status_id",event_value:a},{event_type:"status_name",event_value:e}],this.checkConditions()}else this.additionalSecondEventFlag=!1,this.saveScenario.additional_event=[],this.fullConditions=!1},selectAdditionalSecondEvent:function(t){var i=t.target.value,a=$(t.target).find("option:selected").text().trim();-1!=i?(this.saveScenario.additional_event[0].length=4,this.saveScenario.additional_event[0].push({event_type:"crm_status_id",event_value:i},{event_type:"crm_status_name",event_value:a}),this.additionalSecondEventCondition=!0,this.checkConditions()):(this.additionalSecondEventCondition=!1,this.fullConditions=!1)},selectAdditionalAction:function(t){var i=this,a=t.target.value,e=$(t.target).find("option:selected").text().trim();if(-1!=a)switch(this.saveScenario.action[0].id){case 7:this.saveScenario.additional_action[0]=[{action_type:"type",action_value:2},{action_type:"crm",action_value:this.crmStates.crm_type},{action_type:"program_id",action_value:a},{action_type:"program_name",action_value:e}],this.additionalSecondActionsList=[],$.each(this.crmStates.programs,function(t,e){e.program_id==a&&(i.additionalSecondActionsList=e.states)}),this.additionalSecondActionFlag=!0;break;case 8:this.saveScenario.additional_action[0]=[{action_type:"type",action_value:3},{action_type:"status_id",action_value:a},{action_type:"status_name",action_value:e}],this.checkConditions()}else this.additionalSecondActionFlag=!1,this.saveScenario.additional_action=[],this.fullConditions=!1},selectAdditionalSecondAction:function(t){var i=t.target.value,a=$(t.target).find("option:selected").text().trim();-1!=i?(this.saveScenario.additional_action[0].length=4,this.saveScenario.additional_action[0].push({action_type:"crm_status_id",action_value:i},{action_type:"crm_status_name",action_value:a}),this.additionalSecondActionCondition=!0,this.checkConditions()):(this.additionalSecondActionCondition=!1,this.fullConditions=!1)},inputAdditionalAction:function(t){var i=$(t.target).val().trim();""!=i?(this.saveScenario.additional_action[0]=[{action_type:"type",action_value:"task"},{action_type:"text",action_value:i}],this.checkConditions()):(this.saveScenario.additional_action=[],this.fullConditions=!1)},selectAction:function(t){var i=this,a=Number(t.target.value),e=$(t.target).find("option:selected").text().trim();if(-1!=a)switch(this.saveScenario.action[0]={id:a,name:e},this.additionalActionsList=[],this.additionalSecondActionsList=[],this.additionalSecondActionFlag=!1,this.additionalSecondActionCondition=!1,a){case 4:this.additionalActionFlag=!0,this.additionalActionType="input",this.fullConditions=!1;break;case 7:this.disIfChanged=!0,window.axios.get("/settings/scenario/get/additional-actions/"+a).then(function(t){var a=t.data;a.programs.length&&(i.additionalActionType="select",i.crmStates=a,i.additionalActionFlag=!0,i.additionalActionsList.push({id:-1,name:"Выберите схему сделки или воронку"}),$.each(a.programs,function(t,a){i.additionalActionsList.push({id:a.program_id,name:a.program_name})})),i.fullConditions=!1,i.disIfChanged=!1}).catch(function(t){window.ajaxError(t)});break;case 8:this.disIfChanged=!0,window.axios.get("/settings/scenario/get/additional-actions/"+a).then(function(t){var a=t.data;i.additionalActionFlag=!0,i.fullConditions=!1,a.length&&(i.additionalActionType="select",i.additionalActionFlag=!0,i.additionalActionsList.push({id:-1,name:"Выберите статус КП"}),$.each(a,function(t,a){i.additionalActionsList.push({id:a.id,name:a.name})})),i.disIfChanged=!1}).catch(function(t){window.ajaxError(t)});break;default:this.additionalActionFlag=!1,this.checkConditions()}else this.saveScenario.action=[],this.fullConditions=!1,this.additionalActionFlag=!1},checkConditions:function(){(!this.additionalEventFlag||this.saveScenario.additional_event.length)&&(!this.additionalActionFlag||this.saveScenario.additional_action.length)&&(!this.additionalSecondEventFlag||this.additionalSecondEventCondition)&&(!this.additionalSecondActionFlag||this.additionalSecondActionCondition)?this.saveScenario.event.length&&this.saveScenario.action.length&&(this.fullConditions=!0):this.fullConditions=!1},saveNewScenario:function(){var t=this;this.saveScenario.action.length&&this.saveScenario.event.length&&(this.disIfChanged=!0,this.disabledSaveBtn=!0,window.axios.post("/settings/scenario/add",this.saveScenario).then(function(i){if(i.data.status){var a=t.saveScenario.event[0].id,e=t.saveScenario.event[0].name,n=t.saveScenario.action[0].id,o=t.saveScenario.action[0].name,s=t.saveScenario.additional_event,d=t.saveScenario.additional_action,c="",l="";s.length&&$.each(s[0],function(t,i){switch(Number(a)){case 2:switch(i.event_type){case"id":i.event_value;break;case"name":c=i.event_value}break;case 8:switch(i.event_type){case"id":i.event_value;break;case"program_name":c='по схеме "'+i.event_value+'"';break;case"crm_status_name":c+=' на статус "'+i.event_value+'"'}break;case 9:switch(i.event_type){case"status_id":i.event_value;break;case"status_name":c='на "'+i.event_value+'"'}}}),d.length&&$.each(d[0],function(t,i){switch(Number(n)){case 4:switch(i.action_type){case"text":l='с описанием: "'+i.action_value+'"'}break;case 7:switch(i.action_type){case"id":i.action_value;break;case"program_name":l='по схеме "'+i.action_value+'"';break;case"crm_status_name":l+=' на статус "'+i.action_value+'"'}break;case 8:switch(i.action_type){case"status_id":i.action_value;break;case"status_name":l='на "'+i.action_value+'"'}}}),t.storedScenario.push({event_id:a,event_name:e,action_id:n,action_name:o,additional_event:c,additional_action:l}),t.disIfChanged=!1,t.disabledSaveBtn=!1,$("#modal-scenario").modal("hide")}}).catch(function(i){window.ajaxError(i),t.disabledSaveBtn=!1}))},deleteScenario:function(t,i){var a=this;window.axios.post("/settings/scenario/delete",i).then(function(i){a.storedScenario.splice(t,1)}).catch(function(t){window.ajaxError(t)})}}})}});