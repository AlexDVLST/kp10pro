!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=15)}({15:function(e,t,i){e.exports=i("qcCu")},qcCu:function(e,t){new Vue({el:"#app",data:{employeeFromCrm:[],employeeToKP:[],isDisabled:!1,type:"",isCheck:[],btnName:"Отобразить добавленных",btnStatus:!0,kp10UserList:[],tempEmployeeList:[],addedId:[],employeeList:[],clientsCnt:0,offersCnt:0,employeeName:"",noAssigned:!0,employeeForDelete:0,employeeForReplacement:0},mounted:function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","/plugins/select2/dist/css/select2.min.css"),document.head.insertBefore(e,document.head.firstChild);var t=document.createElement("script");t.setAttribute("src","/plugins/select2/dist/js/select2.full.min.js"),document.head.appendChild(t)},methods:{deleteEmployee:function(e){var t=this,i=$(e.target).data("id"),n=$(e.target).data("name");this.isDisabled=!0,this.noAssigned=!0,i&&window.axios.get("/settings/employee/getClientsOffersList/"+i).then(function(e){var o=e.data,s=o.clients.length,a=o.offers,c=o.userList;t.employeeList=c,t.clientsCnt=s,t.offersCnt=a,t.employeeName=n,t.employeeForDelete=i,0==s&&0==a&&(t.noAssigned=!1,t.isDisabled=!1),$("#popup-delete-employee").modal("show"),0!=t.offersCnt&&0!=t.clientsCnt&&t.$nextTick(function(){var e=this;$("#employee-to-replace").select2({language:"ru",placeholder:"Выберите сотрудника",width:"100%"}).on("change",function(t){-1!=$(t.target).val()?(e.isDisabled=!1,e.employeeForReplacement=$(t.target).val()):(e.isDisabled=!0,e.employeeForReplacement=0)})})}).catch(function(e){window.ajaxError(e)})},confirmDeletion:function(e){window.axios.delete("/settings/employee/"+this.employeeForDelete+"/"+this.employeeForReplacement).then(function(){location.reload()}).catch(function(e){window.ajaxError(e)})},importUser:function(e){var t=this,i=$(e.target).data("type");window.axios.get("/settings/employee/json").then(function(e){var i=e.data;t.kp10UserList=i}).catch(function(e){window.ajaxError(e)}),1==i&&(this.type="megaplan",window.axios.get("/settings/integration/crm/megaplan/employees").then(function(e){var i=e.data;t.employeeFromCrm=[],i.forEach(function(e){var i="",n="";e.contactInfo&&e.contactInfo.forEach(function(e){"email"==e.type&&(i=e.value),"phone"==e.type&&(n=e.value)}),t.tempEmployeeList.push({id:e.id,firstName:e.firstName,lastName:e.lastName,middleName:e.middleName,email:i,phone:n,position:e.position})});var n=[];t.kp10UserList.forEach(function(e){e.megaplan&&n.push(e.megaplan.megaplan_user_id)}),t.employeeFromCrm=t.tempEmployeeList.filter(function(e){if(-1===n.indexOf(parseInt(e.id)))return e}),t.$nextTick(function(){$('input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_flat-blue"}).on("ifChanged",function(e){$(e.target).trigger("click")}),$(".checkAll").on("click",function(e){$(this).closest("div").hasClass("checked")?$("input[type='checkbox']").not(":first").iCheck("uncheck"):$("input[type='checkbox']").not(":first").iCheck("check")})}),$("#popup-import-employee").modal("show")}).catch(function(e){window.ajaxError(e)})),2==i&&(this.type="amocrm",window.axios.get("/settings/integration/crm/amocrm/employees").then(function(e){var i=e.data;$(i).each(function(e,i){t.employeeFromCrm.push({id:i.id,firstName:i.name,lastName:i.last_name,middleName:"",phone:"",position:"",email:i.login})}),t.$nextTick(function(){$('input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_flat-blue"}).on("ifChanged",function(e){$(e.target).trigger("click")}),$(".checkAll").on("click",function(e){$(this).closest("div").hasClass("checked")?$("input[type='checkbox']").not(":first").iCheck("uncheck"):$("input[type='checkbox']").not(":first").iCheck("check")})}),$("#popup-import-employee").modal("show")}).catch(function(e){window.ajaxError(e)})),3==i&&(this.type="bitrix24",window.axios.get("/settings/integration/crm/bitrix24/employees").then(function(e){var i=e.data;t.employeeFromCrm=[],$(i).each(function(e,i){t.tempEmployeeList.push({id:i.ID,firstName:i.NAME,lastName:i.LAST_NAME,middleName:i.SECOND_NAME,phone:i.PERSONAL_MOBILE,position:i.WORK_POSITION,email:i.EMAIL})});var n=[];t.kp10UserList.forEach(function(e){e.megaplan&&n.push(e.megaplan.megaplan_user_id)}),t.employeeFromCrm=t.tempEmployeeList.filter(function(e){if(-1===n.indexOf(parseInt(e.id)))return e}),t.$nextTick(function(){$('input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_flat-blue"}).on("ifChanged",function(e){$(e.target).trigger("click")}),$(".checkAll").on("click",function(e){$(this).closest("div").hasClass("checked")?$("input[type='checkbox']").not(":first").iCheck("uncheck"):$("input[type='checkbox']").not(":first").iCheck("check")})}),$("#popup-import-employee").modal("show")}).catch(function(e){window.ajaxError(e)}))},addEmployee:function(e){if(this.isCheck[e])this.employeeToKP.splice(e,1),this.isCheck[e]=!1;else{var t=this.employeeFromCrm[e];"amocrm"==this.type&&(this.employeeToKP[e]={id:t.id,name:t.firstName,last_name:t.lastName,login:t.email}),"megaplan"==this.type&&(this.employeeToKP[e]=t),"bitrix24"==this.type&&(this.employeeToKP[e]={NAME:t.firstName,LAST_NAME:t.lastName,EMAIL:t.email,ID:t.id,PERSONAL_MOBILE:t.phone}),this.isCheck[e]=!0}},importBtn:function(){var e=this;this.isDisabled=!0;var t=this.employeeToKP.filter(function(e){return null!=e});window.axios.post("/settings/employee/importFromCRM",{employee:t,type:this.type}).then(function(t){e.isDisabled=!1,$("#popup-import-employee").modal("hide"),location.reload()}).catch(function(e){window.ajaxError(e)})},showHideUser:function(){var e=this,t=[];this.kp10UserList.forEach(function(e){e.megaplan&&t.push(e.megaplan.megaplan_user_id)}),this.btnStatus?(this.employeeFromCrm=this.tempEmployeeList,this.tempEmployeeList.filter(function(i){if(-1!==t.indexOf(parseInt(i.id)))return e.addedId.push(i.id),i.id}),this.btnName="Скрыть добавленных",this.btnStatus=!1):(this.employeeFromCrm=this.tempEmployeeList.filter(function(e){if(-1===t.indexOf(parseInt(e.id)))return e}),this.addedId=[],this.btnName="Отобразить добавленных",this.btnStatus=!0),this.$nextTick(function(){$('input[type="checkbox"]').iCheck({checkboxClass:"icheckbox_flat-blue"}).on("ifChanged",function(e){$(e.target).trigger("click")})})},alreadyAdded:function(e){return-1!==this.addedId.indexOf(e)},alreadyAddedTitle:function(e){return-1===this.addedId.indexOf(e)?"Сотрудник из Вашей CRM":"Этот сотрудник уже добавлен"}}})}});